#!/bin/sh -e
# boe - Batch Opus Encoder

help() {
    printf "boe\n"
    printf "Usage:\n"
    printf "boe [options] -i ALBUMDIR\n"
    printf "\nOptions:"
    printf "\n-i (INPUTDIRECTORY)"
    printf "\n-o (OUTPUTDIRECTORY)"
    printf "\n-b (BITRATE)"
    exit
}

while getopts i:o:b:* option
do
    case "${option}"
    in
    i) INPUT=$(realpath -e "${OPTARG}");;
    o) OUTPUT=$(realpath -e "${OPTARG}");;
    b) BITRATE="${OPTARG}";;
    *) help;;
    esac
done

mkdir -p "$OUTPUT"/"${INPUT##*/}" || exit
for SONG in "$INPUT"/*.flac;
do
    SONGNOEXT="${SONG%.*}"
    printf "Encoding ${SONGNOEXT##*/} to Opus at ${BITRATE}KB/s\n"
    opusenc --quiet --bitrate $BITRATE "$SONG" "$OUTPUT"/"${INPUT##*/}""${SONGNOEXT##*/}.opus"
    printf "${SONGNOEXT##*/} is done encoding\n"
done
